<!-- transaction.xml -->

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.automated.trading.stock.StockManager.stock.transaction.TransactionMapper">

    <resultMap id="TransactionResultMap" type="com.automated.trading.stock.StockManager.stock.transaction.TransactionMapper">
        <id property="transaction_id" column="transaction_id" />
        <result property="sender_key" column="sender_key" />
        <result property="receiver_key" column="receiver_key" />
        <result property="count" column="count" />
        <result property="transaction_input" column="transaction_input" />
        <result property="transaction_output" column="transaction_output" />
        <result property="tran_dt" column="tran_dt" />
        <result property="data_id" column="data_id" />
    </resultMap>

    <insert id="transactionOccurred" parameterType="com.automated.trading.stock.StockManager.stock.transaction.TransactionDto">
        INSERT INTO stockdb.public.transaction (sender_key, receiver_key, count, transaction_input, transaction_output, tran_dt, data_id)
        VALUES (#{sender_key}, #{receiver_key}, #{count}, #{transaction_input}, #{transaction_output}, current_timestamp, #{data_id});
    </insert>

    <select id="getAllTransactions" resultMap="TransactionResultMap">
        SELECT (sender_key, receiver_key, count)
        FROM stockdb.public.transaction
        ORDER BY transaction_id ASC;
    </select>

    <select id="findBySenderKey" resultMap="TransactionResultMap" parameterType="String">
        SELECT (sender_key, receiver_key, count)
        FROM stockdb.public.transaction
        ORDER BY transaction_id ASC
        WHERE sender_key = #{sender_key};
    </select>

    <select id="findByReceiverKey" resultMap="TransactionResultMap" parameterType="String">
        SELECT (sender_key, receiver_key, count)
        FROM stockdb.public.transaction
        ORDER BY transaction_id ASC
        WHERE receiver_key = #{receiver_key};
    </select>

    <select id="findBySignature" resultMap="TransactionResultMap" parameterType="String">
        SELECT (sender_key, receiver_key, count)
        FROM stockdb.public.transaction
        WHERE signature = #{signature};
    </select>

</mapper>
